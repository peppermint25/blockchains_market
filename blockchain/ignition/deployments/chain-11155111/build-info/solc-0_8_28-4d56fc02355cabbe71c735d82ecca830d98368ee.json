{
  "_format": "hh3-sol-build-info-1",
  "id": "solc-0_8_28-4d56fc02355cabbe71c735d82ecca830d98368ee",
  "solcVersion": "0.8.28",
  "solcLongVersion": "0.8.28+commit.7893614a",
  "userSourceNameMap": {
    "contracts/DonationPlatform.sol": "project/contracts/DonationPlatform.sol"
  },
  "input": {
    "language": "Solidity",
    "settings": {
      "evmVersion": "cancun",
      "optimizer": {
        "enabled": true,
        "runs": 200
      },
      "outputSelection": {
        "*": {
          "": [
            "ast"
          ],
          "*": [
            "abi",
            "evm.bytecode",
            "evm.deployedBytecode",
            "evm.methodIdentifiers",
            "metadata"
          ]
        }
      },
      "remappings": []
    },
    "sources": {
      "project/contracts/DonationPlatform.sol": {
        "content": "// SPDX-License-Identifier: MIT\r\npragma solidity ^0.8.19;\r\n\r\ncontract SecondhandMarket {\r\n    \r\n    // === ROLES ===\r\n    address public admin;\r\n    \r\n    // === ENUMS ===\r\n    enum ListingStatus { Active, Sold, Cancelled }\r\n    enum OrderStatus { AwaitingShipment, Shipped, Delivered, Completed, Disputed, Refunded }\r\n    \r\n    // === STRUCTS ===\r\n    struct Listing {\r\n        uint256 id;\r\n        address payable seller;\r\n        string metadataURI;      // IPFS link to item details (images, description, etc.)\r\n        uint256 price;\r\n        ListingStatus status;\r\n        address charity;         // Which charity receives the funds\r\n    }\r\n    \r\n    struct Order {\r\n        uint256 id;\r\n        uint256 listingId;\r\n        address payable buyer;\r\n        address payable seller;\r\n        address charity;\r\n        uint256 amount;\r\n        OrderStatus status;\r\n        uint256 shippedAt;       // Timestamp when seller confirmed shipment\r\n        uint256 deliveredAt;     // Timestamp when buyer confirmed delivery\r\n        string disputeReason;    // If dispute opened, reason is stored here\r\n    }\r\n    \r\n    // === STORAGE ===\r\n    mapping(uint256 => Listing) public listings;\r\n    mapping(uint256 => Order) public orders;\r\n    mapping(address => bool) public verifiedCharities;\r\n    \r\n    uint256 public listingCount;\r\n    uint256 public orderCount;\r\n    \r\n    uint256 public constant DISPUTE_WINDOW = 14 days;\r\n    \r\n    // === EVENTS ===\r\n    event CharityVerified(address indexed charity, bool status);\r\n    event ListingCreated(uint256 indexed listingId, address indexed seller, uint256 price);\r\n    event ListingCancelled(uint256 indexed listingId);\r\n    event ItemPurchased(uint256 indexed orderId, uint256 indexed listingId, address indexed buyer);\r\n    event ItemShipped(uint256 indexed orderId, address indexed seller);\r\n    event DeliveryConfirmed(uint256 indexed orderId, address indexed buyer);\r\n    event FundsReleasedToCharity(uint256 indexed orderId, address indexed charity, uint256 amount);\r\n    event DisputeOpened(uint256 indexed orderId, address indexed buyer, string reason);\r\n    event DisputeResolved(uint256 indexed orderId, bool refunded);\r\n    event RefundIssued(uint256 indexed orderId, address indexed buyer, uint256 amount);\r\n    \r\n    // === MODIFIERS ===\r\n    modifier onlyAdmin() {\r\n        require(msg.sender == admin, \"Only admin can do this\");\r\n        _;\r\n    }\r\n    \r\n    modifier onlyBuyer(uint256 _orderId) {\r\n        require(msg.sender == orders[_orderId].buyer, \"Only buyer can do this\");\r\n        _;\r\n    }\r\n    \r\n    modifier onlySeller(uint256 _orderId) {\r\n        require(msg.sender == orders[_orderId].seller, \"Only seller can do this\");\r\n        _;\r\n    }\r\n    \r\n    // === CONSTRUCTOR ===\r\n    constructor() {\r\n        admin = msg.sender;\r\n    }\r\n    \r\n    // === ADMIN FUNCTIONS ===\r\n    \r\n    function verifyCharity(address _charity, bool _status) external onlyAdmin {\r\n        verifiedCharities[_charity] = _status;\r\n        emit CharityVerified(_charity, _status);\r\n    }\r\n    \r\n    function transferAdmin(address _newAdmin) external onlyAdmin {\r\n        require(_newAdmin != address(0), \"Invalid address\");\r\n        admin = _newAdmin;\r\n    }\r\n    \r\n    // === SELLER FUNCTIONS ===\r\n    \r\n    function createListing(\r\n        string calldata _metadataURI,\r\n        uint256 _price,\r\n        address _charity\r\n    ) external returns (uint256) {\r\n        require(_price > 0, \"Price must be greater than 0\");\r\n        require(verifiedCharities[_charity], \"Charity not verified\");\r\n        \r\n        uint256 listingId = listingCount++;\r\n        \r\n        listings[listingId] = Listing({\r\n            id: listingId,\r\n            seller: payable(msg.sender),\r\n            metadataURI: _metadataURI,\r\n            price: _price,\r\n            status: ListingStatus.Active,\r\n            charity: _charity\r\n        });\r\n        \r\n        emit ListingCreated(listingId, msg.sender, _price);\r\n        return listingId;\r\n    }\r\n    \r\n    function cancelListing(uint256 _listingId) external {\r\n        Listing storage listing = listings[_listingId];\r\n        require(msg.sender == listing.seller, \"Only seller can cancel\");\r\n        require(listing.status == ListingStatus.Active, \"Listing not active\");\r\n        \r\n        listing.status = ListingStatus.Cancelled;\r\n        emit ListingCancelled(_listingId);\r\n    }\r\n    \r\n    function confirmShipment(uint256 _orderId) external onlySeller(_orderId) {\r\n        Order storage order = orders[_orderId];\r\n        require(order.status == OrderStatus.AwaitingShipment, \"Invalid order status\");\r\n        \r\n        order.status = OrderStatus.Shipped;\r\n        order.shippedAt = block.timestamp;\r\n        \r\n        emit ItemShipped(_orderId, msg.sender);\r\n    }\r\n    \r\n    // === BUYER FUNCTIONS ===\r\n    \r\n    function purchaseItem(uint256 _listingId) external payable returns (uint256) {\r\n        Listing storage listing = listings[_listingId];\r\n        require(listing.status == ListingStatus.Active, \"Listing not available\");\r\n        require(msg.value == listing.price, \"Incorrect payment amount\");\r\n        require(msg.sender != listing.seller, \"Seller cannot buy own item\");\r\n        \r\n        // Update listing status\r\n        listing.status = ListingStatus.Sold;\r\n        \r\n        // Create order\r\n        uint256 orderId = orderCount++;\r\n        \r\n        orders[orderId] = Order({\r\n            id: orderId,\r\n            listingId: _listingId,\r\n            buyer: payable(msg.sender),\r\n            seller: listing.seller,\r\n            charity: listing.charity,\r\n            amount: msg.value,\r\n            status: OrderStatus.AwaitingShipment,\r\n            shippedAt: 0,\r\n            deliveredAt: 0,\r\n            disputeReason: \"\"\r\n        });\r\n        \r\n        emit ItemPurchased(orderId, _listingId, msg.sender);\r\n        return orderId;\r\n    }\r\n    \r\n    function confirmDelivery(uint256 _orderId) external onlyBuyer(_orderId) {\r\n        Order storage order = orders[_orderId];\r\n        require(order.status == OrderStatus.Shipped, \"Item not shipped yet\");\r\n        \r\n        order.status = OrderStatus.Delivered;\r\n        order.deliveredAt = block.timestamp;\r\n        \r\n        emit DeliveryConfirmed(_orderId, msg.sender);\r\n    }\r\n    \r\n    function openDispute(uint256 _orderId, string calldata _reason) external onlyBuyer(_orderId) {\r\n        Order storage order = orders[_orderId];\r\n        require(\r\n            order.status == OrderStatus.Shipped || order.status == OrderStatus.Delivered,\r\n            \"Cannot dispute at this stage\"\r\n        );\r\n        \r\n        // If delivered, must be within dispute window\r\n        if (order.status == OrderStatus.Delivered) {\r\n            require(\r\n                block.timestamp <= order.deliveredAt + DISPUTE_WINDOW,\r\n                \"Dispute window has passed\"\r\n            );\r\n        }\r\n        \r\n        order.status = OrderStatus.Disputed;\r\n        order.disputeReason = _reason;\r\n        \r\n        emit DisputeOpened(_orderId, msg.sender, _reason);\r\n    }\r\n    \r\n    // === FUNDS RELEASE ===\r\n    \r\n    function releaseFundsToCharity(uint256 _orderId) external {\r\n        Order storage order = orders[_orderId];\r\n        require(order.status == OrderStatus.Delivered, \"Delivery not confirmed\");\r\n        require(\r\n            block.timestamp > order.deliveredAt + DISPUTE_WINDOW,\r\n            \"Still within dispute window\"\r\n        );\r\n        \r\n        order.status = OrderStatus.Completed;\r\n        \r\n        // Transfer funds to charity\r\n        (bool success, ) = order.charity.call{value: order.amount}(\"\");\r\n        require(success, \"Transfer to charity failed\");\r\n        \r\n        emit FundsReleasedToCharity(_orderId, order.charity, order.amount);\r\n    }\r\n    \r\n    // === DISPUTE RESOLUTION (ADMIN) ===\r\n    \r\n    function resolveDispute(uint256 _orderId, bool _refundBuyer) external onlyAdmin {\r\n        Order storage order = orders[_orderId];\r\n        require(order.status == OrderStatus.Disputed, \"Order not disputed\");\r\n        \r\n        if (_refundBuyer) {\r\n            order.status = OrderStatus.Refunded;\r\n            \r\n            (bool success, ) = order.buyer.call{value: order.amount}(\"\");\r\n            require(success, \"Refund failed\");\r\n            \r\n            emit RefundIssued(_orderId, order.buyer, order.amount);\r\n        } else {\r\n            order.status = OrderStatus.Completed;\r\n            \r\n            (bool success, ) = order.charity.call{value: order.amount}(\"\");\r\n            require(success, \"Transfer to charity failed\");\r\n            \r\n            emit FundsReleasedToCharity(_orderId, order.charity, order.amount);\r\n        }\r\n        \r\n        emit DisputeResolved(_orderId, _refundBuyer);\r\n    }\r\n    \r\n    // === VIEW FUNCTIONS ===\r\n    \r\n    function getListing(uint256 _listingId) external view returns (\r\n        address seller,\r\n        string memory metadataURI,\r\n        uint256 price,\r\n        ListingStatus status,\r\n        address charity\r\n    ) {\r\n        Listing storage l = listings[_listingId];\r\n        return (l.seller, l.metadataURI, l.price, l.status, l.charity);\r\n    }\r\n    \r\n    function getOrder(uint256 _orderId) external view returns (\r\n        uint256 listingId,\r\n        address buyer,\r\n        address seller,\r\n        address charity,\r\n        uint256 amount,\r\n        OrderStatus status,\r\n        uint256 shippedAt,\r\n        uint256 deliveredAt\r\n    ) {\r\n        Order storage o = orders[_orderId];\r\n        return (o.listingId, o.buyer, o.seller, o.charity, o.amount, o.status, o.shippedAt, o.deliveredAt);\r\n    }\r\n    \r\n    function getDisputeReason(uint256 _orderId) external view returns (string memory) {\r\n        return orders[_orderId].disputeReason;\r\n    }\r\n}"
      }
    }
  }
}